<!doctype html>
<html lang="en">

<head style="padding:20px">
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

  <title>Hello, world!</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body style="padding:20px">

  <h1>Hello, world!</h1>

  <!-- Option 1: Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
    crossorigin="anonymous"></script>

  <h1>Shopify Challenge</h1>

  <!-- div for search bar and the results-->
  <div class="input-group mb-3">
    <form id='searchButton'>
      <input type="text" name="movieSearchBar" placeholder="Enter Movie Name here..">
      <input type="submit" value="Search" class="btn btn-primary">
    </form>
  </div>

  <div class="d-md-flex flex-md-equal w-100 my-md-3 pl-md-3">

    <div class="row">
      <div class="col-sm-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Search Results</h5>
            <div class="container" id="movieSearchResult">
            </div>
          </div>
        </div>

      </div>

      <div class="col-sm-6">
        <div class="card">
          <div class="card-body" id="nominatedMovies">
            <h5 class="card-title">Nonminated Movies</h5>

          </div>
        </div>
      </div>
    </div>
  </div>



  <script>
    var nominatedList = new Set();

    const nominateLimit = 5;
    var currNominatedNum = 0;



    function checkSearchResultButton() {
      console.log("checkButton:" + nominatedList);

      $("#movieSearchResult").find("button").each(function () {

        if (!nominatedList.has((this).id)) {


          $(this).prop('disabled', false);
          console.log(this.id + " Not Disabled");

        }
        else if (nominatedList.has((this).id)) {

          console.log(this.id + " Disabled");
          $(this).prop('disabled', true);

        }
      });


    }


    $('#searchButton').on('submit', function (ev) {

      // clear the prevous search outcome
      $("#movieSearchResult").empty();
      /*  
     
       */
      // perform search and show the result
      ev.preventDefault();
      var value = $('input[name=movieSearchBar]').val();


      $.getJSON('http://www.omdbapi.com/?&apikey=2170dc30&type=movie&s=' + value, function (data) {
        var items = [];
        var count = 0;

        $.each(data.Search, function (entryIndex, entry) {

          var nominateImdbID = this.imdbID;

          if (!nominatedList.has(nominateImdbID)) {

            items.push('<li class="list-group-item d-flex justify-content-between align-items-center"><p>' + this.Title + " (" + this.Year + ")"
              + '</p><button type="button" class="btn btn-warning btn-sm" id="' + nominateImdbID + '">Nominate ' + count + '</button></li>');
            // check if the item is already in the nominated list


            count++;
          }
          else {
            items.push('<li class="list-group-item d-flex justify-content-between align-items-center"><p>' + this.Title + " (" + this.Year + ")"
              + '</p><button type="button" class="btn btn-warning btn-sm" id="' + nominateImdbID + '"disabled>Nominate ' + count + '</button></li>');
            // check if the item is already in the nominated list


            count++;

          }



        });



        $("<ul/>", {
          "class": "list-group",
          html: items.join("")
        }).appendTo("#movieSearchResult");
      });




      console.log(nominatedList);

    });



    // add click listener to the dynamically created buttons
    // 1. pop up the alert 
    // 2. disable the button
    // 3. add the record to the nominated list
    $('#movieSearchResult').on('click', 'button', function () {
      if (!nominatedList.has(this.id)) {
        alert("Not included");
      }


      //if the user has nominated less than 5 movies
      if (currNominatedNum < nominateLimit) {

        currNominatedNum++;
        nominatedList.add(this.id);
        console.log(this.id);

        alert("Nominated!");

        $(this).prop('disabled', true);

        var butt = $("<button></button>").text("Text.");

        $(this).parent("li").children("p").clone().appendTo("#nominatedMovies").append('<button type="button" class="btn btn-warning btn-sm" id="' + this.id + '">Remove</button>');
        $(this).parent("li").children("p").clone().appendTo("#nominatedList");

        //$("#nominatedMovies").children("li").appendChild(butt);
      }
      //if the use has already nominated 5 movies, then the user cannot continue to nominate
      else {
        alert("Already nominated 5 movies! This will not be added to the list.");
      }


    });


    // when click remove button, the list item should be deleted
    $('#nominatedMovies').on('click', 'button', function () {

      $(this).parent("p").remove();
      nominatedList.delete(this.id);
      currNominatedNum--;


      alert("Removed!");
      checkSearchResultButton();








    });




  </script>

</body>


</html>